apiVersion: canaries.flanksource.com/v1
kind: Canary
metadata:
  name: base-image-canary-checker-selftest
spec:
  schedule: "@every 5m"
  exec:
    - name: java
      description: "Java is available"
      script: java --version | head -1
      test:
        expr: 'results.exitCode == 0'

    - name: jmeter
      description: "JMeter is available"
      script: jmeter --version 2>&1 | head -1
      test:
        expr: 'results.stdout.contains("Apache JMeter") || results.stderr.contains("Apache JMeter")'

    - name: restic
      description: "restic is available"
      script: restic version
      test:
        expr: 'results.stdout.contains("restic")'

    - name: k6
      description: "k6 is available"
      script: k6 version
      test:
        expr: 'results.stdout.contains("k6")'

    - name: benthos
      description: "benthos is available"
      script: benthos --version
      test:
        expr: 'results.exitCode == 0'

    - name: pipenv
      description: "pipenv is available"
      script: pipenv --version
      test:
        expr: 'results.stdout.contains("pipenv")'
